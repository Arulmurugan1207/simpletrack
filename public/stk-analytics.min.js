!function(e){"use strict";let t={apiUrl:"",serviceName:"unknown",batchIntervalMs:5e3,debug:!1,autoTrackPageViews:!0,autoTrackClicks:!0,autoTrackScroll:!0,autoTrackPerformance:!0},n=[],i=null,o=0,a=0,r=Date.now(),c="",s="",l=null,u=!1;function g(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function d(){if(void 0===e||!e.location)return{};const t=new URLSearchParams(e.location.search);return{utm_source:t.get("utm_source"),utm_medium:t.get("utm_medium"),utm_campaign:t.get("utm_campaign"),utm_term:t.get("utm_term"),utm_content:t.get("utm_content"),landing_page:e.location.pathname+e.location.search,landing_domain:e.location.hostname,referrer:document.referrer||null,referrer_domain:document.referrer?new URL(document.referrer).hostname:null}}function m(){try{const e="__analytics_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch{return!1}}function _(){try{const e="__analytics_test__";return sessionStorage.setItem(e,e),sessionStorage.removeItem(e),!0}catch{return!1}}function y(e,t=localStorage){try{return t.getItem(e)}catch{return null}}function f(e,n,i=localStorage){try{i.setItem(e,n)}catch(e){t.debug&&console.warn("[Analytics] Storage error:",e)}}function p(){const e=y("analytics_session_id",sessionStorage);if(_()){y("analytics_unique_visitor_session",sessionStorage)!==e&&(v("unique_visitor_session",{category:"visitor",custom:{first_visit_session:!0,visitor_type:"unique",tracking_type:"per_session"}}),f("analytics_unique_visitor_session",e,sessionStorage))}if(m()){const e=(new Date).toDateString();y("analytics_unique_visitor_day")!==e&&(v("unique_visitor_daily",{category:"visitor",custom:{first_visit_day:!0,visitor_type:"unique",tracking_type:"per_day"}}),f("analytics_unique_visitor_day",e))}}function v(i,r={}){const u=d(),g="undefined"==typeof navigator?{}:{userAgent:navigator.userAgent,language:navigator.language,platform:navigator.platform,screenResolution:`${screen.width}x${screen.height}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,cookieEnabled:navigator.cookieEnabled,online:navigator.onLine},_={event_category:r.category||"engagement",event_label:r.label||null,value:r.value||null,custom_parameters:r.custom||{},user_id:s,user_email:l,session_id:c,user_type:l?"authenticated":"anonymous",first_visit:y("analytics_first_visit")||(new Date).toISOString(),visit_count:parseInt(y("analytics_visit_count")||"0")+1,page:e.location?e.location.pathname:"",page_title:document.title||"",page_load_time:o,scroll_depth:a,time_on_page:0,attribution:u,...g,...r};m()&&(f("analytics_visit_count",_.visit_count.toString()),y("analytics_first_visit")||f("analytics_first_visit",_.first_visit));const p={event_name:i,user_id:s,user_email:l||void 0,data:_,service:t.serviceName};n.push(p),t.debug&&console.log(`[Analytics] Event "${i}":`,r)}async function h(){if(0===n.length||!t.apiUrl)return;if(t.debug)return t.debug&&console.log("[Analytics] Debug mode: Not sending batch to backend. Events in queue:",n.length),void(n=[]);const e=[...n];n=[],t.debug&&console.log("[Analytics] Sending batch:",e.length,"events");try{const n=await fetch(t.apiUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);t.debug&&console.log("[Analytics] Batch sent successfully")}catch(i){t.debug&&console.error("[Analytics] Batch send failed:",i),n.unshift(...e)}}const x={init:function(n={}){u?t.debug&&console.warn("[Analytics] Already initialized"):(t={...t,...n},t.apiUrl||(t.apiUrl="https://analytics-dot-node-server-apis.ue.r.appspot.com/analytics/log"),_()?(c=y("analytics_session_id",sessionStorage)||g(),f("analytics_session_id",c,sessionStorage)):c=g(),m()?(s=y("analytics_user_id")||g(),f("analytics_user_id",s),l=y("userEmail")):s=g(),void 0!==e&&"undefined"!=typeof document&&(e.addEventListener("load",()=>{o=performance.now(),v("page_load_complete",{category:"performance",custom:{load_time:o,dom_ready:performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]&&performance.getEntriesByType("navigation")[0].domContentLoadedEventEnd||0,fully_loaded:!0}})}),t.autoTrackScroll&&e.addEventListener("scroll",()=>{const t=e.pageYOffset||document.documentElement.scrollTop,n=document.body.offsetHeight||document.documentElement.offsetHeight,i=e.innerHeight,o=Math.round(t/(n-i)*100);a=Math.max(a,o)}),e.addEventListener("pagehide",()=>{v("page_exit",{time_on_page:Date.now()-r,scroll_depth:a,page:e.location?e.location.pathname:""}),h().catch(e=>{t.debug&&console.error("[Analytics] Page exit batch failed:",e)})}),document.addEventListener("visibilitychange",()=>{document.hidden?v("page_hidden",{time_on_page:Date.now()-r,scroll_depth:a,page:e.location?e.location.pathname:""}):r=Date.now()}),t.autoTrackClicks&&document.addEventListener("click",e=>{const t=e.target.closest("[data-click]");if(t){const n=t.getAttribute("data-click")||"click";v("click",{category:"interaction",label:t.textContent||t.innerText||"",element:t.tagName,href:t.href||null,click_type:n,custom:{x:e.clientX,y:e.clientY}})}}),t.autoTrackPageViews&&(v("page_view"),p(),setTimeout(()=>{v("session_start",{category:"session",custom:{session_type:"new"}})},100))),i&&clearInterval(i),i=setInterval(()=>{h().catch(e=>{t.debug&&console.error("[Analytics] Batch timer error:",e)})},t.batchIntervalMs),u=!0,t.debug&&console.log("[Analytics] Initialized with config:",t))},trackEvent:function(e,n={}){u?v(e,n):t.debug&&console.warn("[Analytics] Not initialized. Call Analytics.init() first.")},trackInteraction:function(e,t,n={}){this.trackEvent("interaction",{category:"interaction",action:e,label:t,...n})},trackNavigation:function(e,t={}){this.trackEvent("navigation",{category:"navigation",page:e,...t})},trackError:function(e,t={}){this.trackEvent("error",{category:"error",error_message:e,...t})},trackPerformance:function(e,t,n={}){this.trackEvent("performance",{category:"performance",metric:e,value:t,...n})},setUserEmail:function(e){l=e,m()&&f("userEmail",e),t.debug&&console.log(`[Analytics] User email set: ${e}`)},clearUserEmail:function(){l=null,m()&&localStorage.removeItem("userEmail"),t.debug&&console.log("[Analytics] User email cleared")},trackPromoImpression:function(e,t={}){this.trackEvent("promo_impression",{category:"promo",promo_id:e,...t,...d()})},trackPromoClick:function(e,t="click",n={}){this.trackEvent("promo_click",{category:"promo",promo_id:e,action:t,...n,...d()})},sendBatch:function(){return h()},trackUniqueVisitor:function(){p()},getConfig:function(){return{...t}},updateConfig:function(e){t={...t,...e},t.debug&&console.log("[Analytics] Config updated:",t)}};e.STKAnalytics=x,e.AnalyticsConfig&&x.init(e.AnalyticsConfig)}("undefined"!=typeof window?window:{});