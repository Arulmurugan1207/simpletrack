!function(t){"use strict";let e={apiUrl:"",serviceName:"unknown",batchIntervalMs:5e3,debug:!1,autoTrackPageViews:!0,autoTrackClicks:!0,autoTrackScroll:!0,autoTrackPerformance:!0},n=[],a=null,i=0,o=0,r=Date.now(),s="",c="",l=null,u=!1;function g(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}function d(){if(void 0===t||!t.location)return{};const e=new URLSearchParams(t.location.search);return{utm_source:e.get("utm_source"),utm_medium:e.get("utm_medium"),utm_campaign:e.get("utm_campaign"),utm_term:e.get("utm_term"),utm_content:e.get("utm_content"),landing_page:t.location.pathname+t.location.search,landing_domain:t.location.hostname,referrer:document.referrer||null,referrer_domain:document.referrer?new URL(document.referrer).hostname:null}}function m(){try{const t="__analytics_test__";return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch{return!1}}function _(){try{const t="__analytics_test__";return sessionStorage.setItem(t,t),sessionStorage.removeItem(t),!0}catch{return!1}}function y(t,e=localStorage){try{return e.getItem(t)}catch{return null}}function f(t,n,a=localStorage){try{a.setItem(t,n)}catch(t){e.debug&&console.warn("[Analytics] Storage error:",t)}}function p(){const t=y("analytics_session_id",sessionStorage);if(_()){y("analytics_unique_visitor_session",sessionStorage)!==t&&(v("unique_visitor_session",{category:"visitor",custom:{first_visit_session:!0,visitor_type:"unique",tracking_type:"per_session"}}),f("analytics_unique_visitor_session",t,sessionStorage))}if(m()){const t=(new Date).toDateString();y("analytics_unique_visitor_day")!==t&&(v("unique_visitor_daily",{category:"visitor",custom:{first_visit_day:!0,visitor_type:"unique",tracking_type:"per_day"}}),f("analytics_unique_visitor_day",t))}}function v(a,r={}){const u=d(),g="undefined"==typeof navigator?{}:{userAgent:navigator.userAgent,language:navigator.language,platform:navigator.platform,screenResolution:`${screen.width}x${screen.height}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,cookieEnabled:navigator.cookieEnabled,online:navigator.onLine},_={event_category:r.category||"engagement",event_label:r.label||null,value:r.value||null,custom_parameters:r.custom||{},user_id:c,user_email:l,session_id:s,user_type:l?"authenticated":"anonymous",first_visit:y("analytics_first_visit")||(new Date).toISOString(),visit_count:parseInt(y("analytics_visit_count")||"0")+1,page:t.location?t.location.pathname:"",page_title:document.title||"",page_load_time:i,scroll_depth:o,time_on_page:0,attribution:u,...g,...r};m()&&(f("analytics_visit_count",_.visit_count.toString()),y("analytics_first_visit")||f("analytics_first_visit",_.first_visit));const p={event_name:a,user_id:c,user_email:l||void 0,data:_,service:e.serviceName};n.push(p),e.debug&&console.log(`[Analytics] Event "${a}":`,r)}async function h(){if(0===n.length||!e.apiUrl)return;if(e.debug)return e.debug&&console.log("[Analytics] Debug mode: Not sending batch to backend. Events in queue:",n.length),void(n=[]);const t=[...n];n=[],e.debug&&console.log("[Analytics] Sending batch:",t.length,"events");try{const n=await fetch(e.apiUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);e.debug&&console.log("[Analytics] Batch sent successfully")}catch(a){e.debug&&console.error("[Analytics] Batch send failed:",a),n.unshift(...t)}}const b={init:function(n={}){if(u)e.debug&&console.warn("[Analytics] Already initialized");else{if(e={...e,...n},e.apiUrl){const t=new URL(e.apiUrl);t.searchParams.has("service")||(t.searchParams.set("service",e.serviceName),e.apiUrl=t.toString())}else e.apiUrl=`https://analytics-dot-node-server-apis.ue.r.appspot.com/analytics/log?service=${e.serviceName}`;_()?(s=y("analytics_session_id",sessionStorage)||g(),f("analytics_session_id",s,sessionStorage)):s=g(),m()?(c=y("analytics_user_id")||g(),f("analytics_user_id",c),l=y("userEmail")):c=g(),void 0!==t&&"undefined"!=typeof document&&(t.addEventListener("load",()=>{i=performance.now(),v("page_load_complete",{category:"performance",custom:{load_time:i,dom_ready:performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]&&performance.getEntriesByType("navigation")[0].domContentLoadedEventEnd||0,fully_loaded:!0}})}),e.autoTrackScroll&&t.addEventListener("scroll",()=>{const e=t.pageYOffset||document.documentElement.scrollTop,n=document.body.offsetHeight||document.documentElement.offsetHeight,a=t.innerHeight,i=Math.round(e/(n-a)*100);o=Math.max(o,i)}),t.addEventListener("pagehide",()=>{v("page_exit",{time_on_page:Date.now()-r,scroll_depth:o,page:t.location?t.location.pathname:""}),h().catch(t=>{e.debug&&console.error("[Analytics] Page exit batch failed:",t)})}),document.addEventListener("visibilitychange",()=>{document.hidden?v("page_hidden",{time_on_page:Date.now()-r,scroll_depth:o,page:t.location?t.location.pathname:""}):r=Date.now()}),e.autoTrackClicks&&document.addEventListener("click",t=>{const e=t.target.closest("[data-click]");if(e){t.stopPropagation();const n=e.getAttribute("data-click")||"click";v("click",{category:"interaction",label:e.textContent||e.innerText||"",element:e.tagName,href:e.href||null,click_type:n,custom:{x:t.clientX,y:t.clientY}})}}),e.autoTrackPageViews&&(v("page_view"),p(),setTimeout(()=>{v("session_start",{category:"session",custom:{session_type:"new"}})},100))),a&&clearInterval(a),a=setInterval(()=>{h().catch(t=>{e.debug&&console.error("[Analytics] Batch timer error:",t)})},e.batchIntervalMs),u=!0,e.debug&&console.log("[Analytics] Initialized with config:",e)}},trackEvent:function(t,n={}){u?v(t,n):e.debug&&console.warn("[Analytics] Not initialized. Call Analytics.init() first.")},trackInteraction:function(t,e,n={}){this.trackEvent("interaction",{category:"interaction",action:t,label:e,...n})},trackNavigation:function(t,e={}){this.trackEvent("navigation",{category:"navigation",page:t,...e})},trackError:function(t,e={}){this.trackEvent("error",{category:"error",error_message:t,...e})},trackPerformance:function(t,e,n={}){this.trackEvent("performance",{category:"performance",metric:t,value:e,...n})},setUserEmail:function(t){l=t,m()&&f("userEmail",t),e.debug&&console.log(`[Analytics] User email set: ${t}`)},clearUserEmail:function(){l=null,m()&&localStorage.removeItem("userEmail"),e.debug&&console.log("[Analytics] User email cleared")},trackPromoImpression:function(t,e={}){this.trackEvent("promo_impression",{category:"promo",promo_id:t,...e,...d()})},trackPromoClick:function(t,e="click",n={}){this.trackEvent("promo_click",{category:"promo",promo_id:t,action:e,...n,...d()})},sendBatch:function(){return h()},trackUniqueVisitor:function(){p()},getConfig:function(){return{...e}},updateConfig:function(t){e={...e,...t},e.debug&&console.log("[Analytics] Config updated:",e)}};t.STKAnalytics=b;const k=function(){const t=document.getElementsByTagName("script");let e=null;for(let n of t)if(n.src&&n.src.includes("stk-analytics")){e=n;break}if(!e)return null;const n={},a=e.getAttribute("data-service-name");return a&&""!==a.trim()?(n.serviceName=a,e.getAttribute("data-batch-interval")&&(n.batchIntervalMs=parseInt(e.getAttribute("data-batch-interval"))),e.getAttribute("data-debug")&&(n.debug="true"===e.getAttribute("data-debug").toLowerCase()),e.getAttribute("data-disable-page-views")&&(n.autoTrackPageViews=!1),e.getAttribute("data-disable-clicks")&&(n.autoTrackClicks=!1),e.getAttribute("data-disable-scroll")&&(n.autoTrackScroll=!1),Object.keys(n).length>0?n:null):null}();k?b.init(k):t.AnalyticsConfig&&b.init(t.AnalyticsConfig)}("undefined"!=typeof window?window:{});