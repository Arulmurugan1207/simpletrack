!function(t){"use strict";let e={apiUrl:"https://analytics-dot-node-server-apis.ue.r.appspot.com/analytics/log",apiKey:"unknown",batchIntervalMs:5e3,debug:!1,autoTrackPageViews:!0,autoTrackClicks:!0,autoTrackScroll:!0,autoTrackPerformance:!0},n=[],i=null,a=0,o=0,r=Date.now(),s="",c="",l=null,u=!1,g=!1;function d(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}function m(){if(void 0===t||!t.location)return{};const e=new URLSearchParams(t.location.search);return{utm_source:e.get("utm_source"),utm_medium:e.get("utm_medium"),utm_campaign:e.get("utm_campaign"),utm_term:e.get("utm_term"),utm_content:e.get("utm_content"),landing_page:t.location.pathname+t.location.search,landing_domain:t.location.hostname,referrer:document.referrer||null,referrer_domain:document.referrer?new URL(document.referrer).hostname:null}}function y(){try{const t="__analytics_test__";return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch{return!1}}function p(){try{const t="__analytics_test__";return sessionStorage.setItem(t,t),sessionStorage.removeItem(t),!0}catch{return!1}}function _(t,e=localStorage){try{return e.getItem(t)}catch{return null}}function f(t,n,i=localStorage){try{i.setItem(t,n)}catch(t){e.debug&&console.warn("[Analytics] Storage error:",t)}}function v(){const t=_("analytics_session_id",sessionStorage);if(p()){_("analytics_unique_visitor_session",sessionStorage)!==t&&(h("unique_visitor_session",{category:"visitor",custom:{first_visit_session:!0,visitor_type:"unique",tracking_type:"per_session"}}),f("analytics_unique_visitor_session",t,sessionStorage))}if(y()){const t=(new Date).toDateString();_("analytics_unique_visitor_day")!==t&&(h("unique_visitor_daily",{category:"visitor",custom:{first_visit_day:!0,visitor_type:"unique",tracking_type:"per_day"}}),f("analytics_unique_visitor_day",t))}}function h(i,r={}){if(!e.apiKey||""===e.apiKey.trim()||"unknown"===e.apiKey||g)return void(e.debug&&console.log("[Analytics] No valid API key configured - stopping log for event:",i));const u=m(),d="undefined"==typeof navigator?{}:{userAgent:navigator.userAgent,language:navigator.language,platform:navigator.platform,screenResolution:`${screen.width}x${screen.height}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,cookieEnabled:navigator.cookieEnabled,online:navigator.onLine},p={event_category:r.category||"engagement",event_label:r.label||null,value:r.value||null,custom_parameters:r.custom||{},user_id:c,user_email:l,session_id:s,user_type:l?"authenticated":"anonymous",first_visit:_("analytics_first_visit")||(new Date).toISOString(),visit_count:parseInt(_("analytics_visit_count")||"0")+1,page:t.location?t.location.pathname:"",page_title:document.title||"",page_load_time:a,scroll_depth:o,time_on_page:0,attribution:u,...d,...r};y()&&(f("analytics_visit_count",p.visit_count.toString()),_("analytics_first_visit")||f("analytics_first_visit",p.first_visit));const v={event_name:i,user_id:c,user_email:l||void 0,data:p,service:e.apiKey};n.push(v),e.debug&&console.log(`[Analytics] Event "${i}":`,r)}async function b(){if(0===n.length||!e.apiUrl||!e.apiKey||g)return e.apiKey||console.log("[Analytics] No API key configured - not sending logs"),e.apiUrl||console.log("[Analytics] No API URL configured - not sending logs"),void(g&&console.log("[Analytics] API key is invalid - not sending logs"));if(e.debug)return e.debug&&console.log("[Analytics] Debug mode: Not sending batch to backend. Events in queue:",n.length),void(n=[]);const t=[...n];n=[],e.debug&&console.log("[Analytics] Sending batch:",t.length,"events");try{const a=await fetch(e.apiUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){if(401===a.status)return g=!0,console.error("[Analytics] API key is invalid (401 Unauthorized) - stopping all logging"),i&&(clearInterval(i),i=null),void(n=[]);throw new Error(`HTTP ${a.status}: ${a.statusText}`)}e.debug&&console.log("[Analytics] Batch sent successfully")}catch(i){e.debug&&console.error("[Analytics] Batch send failed:",i),g||n.unshift(...t)}}const k={init:function(n={}){if(u)return void(e.debug&&console.warn("[Analytics] Already initialized"));if(e={...e,...n},!e.apiKey||""===e.apiKey.trim())return void console.error("[Analytics] API key is required and cannot be empty - not initializing");if(!e.apiUrl||""===e.apiUrl.trim())return void console.error("[Analytics] API URL is required and cannot be empty - not initializing");if(!e.apiUrl||""===e.apiUrl.trim())return void console.error("[Analytics] API URL is required and cannot be empty - not initializing");const g=new URL(e.apiUrl);g.searchParams.has("service")||g.searchParams.has("apiKey")||(g.searchParams.set("apiKey",e.apiKey),e.apiUrl=g.toString()),p()?(s=_("analytics_session_id",sessionStorage)||d(),f("analytics_session_id",s,sessionStorage)):s=d(),y()?(c=_("analytics_user_id")||d(),f("analytics_user_id",c),l=_("userEmail")):c=d(),void 0!==t&&"undefined"!=typeof document&&(t.addEventListener("load",()=>{a=performance.now(),h("page_load_complete",{category:"performance",custom:{load_time:a,dom_ready:performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]&&performance.getEntriesByType("navigation")[0].domContentLoadedEventEnd||0,fully_loaded:!0}})}),e.autoTrackScroll&&t.addEventListener("scroll",()=>{const e=t.pageYOffset||document.documentElement.scrollTop,n=document.body.offsetHeight||document.documentElement.offsetHeight,i=t.innerHeight,a=Math.round(e/(n-i)*100);o=Math.max(o,a)}),t.addEventListener("pagehide",()=>{h("page_exit",{time_on_page:Date.now()-r,scroll_depth:o,page:t.location?t.location.pathname:""}),b().catch(t=>{e.debug&&console.error("[Analytics] Page exit batch failed:",t)})}),document.addEventListener("visibilitychange",()=>{document.hidden?h("page_hidden",{time_on_page:Date.now()-r,scroll_depth:o,page:t.location?t.location.pathname:""}):r=Date.now()}),e.autoTrackClicks&&document.addEventListener("click",t=>{const e=t.target.closest("[data-click]");if(e){t.stopPropagation();const n=e.getAttribute("data-click")||"click";h("click",{category:"interaction",label:e.textContent||e.innerText||"",element:e.tagName,href:e.href||null,click_type:n,custom:{x:t.clientX,y:t.clientY}})}}),e.autoTrackPageViews&&(h("page_view"),v(),setTimeout(()=>{h("session_start",{category:"session",custom:{session_type:"new"}})},100))),i&&clearInterval(i),i=setInterval(()=>{b().catch(t=>{e.debug&&console.error("[Analytics] Batch timer error:",t)})},e.batchIntervalMs),u=!0,e.debug&&console.log("[Analytics] Initialized with config:",e)},trackEvent:function(t,n={}){u?h(t,n):e.debug&&console.warn("[Analytics] Not initialized. Call Analytics.init() first.")},trackInteraction:function(t,e,n={}){this.trackEvent("interaction",{category:"interaction",action:t,label:e,...n})},trackNavigation:function(t,e={}){this.trackEvent("navigation",{category:"navigation",page:t,...e})},trackError:function(t,e={}){this.trackEvent("error",{category:"error",error_message:t,...e})},trackPerformance:function(t,e,n={}){this.trackEvent("performance",{category:"performance",metric:t,value:e,...n})},setUserEmail:function(t){l=t,y()&&f("userEmail",t),e.debug&&console.log(`[Analytics] User email set: ${t}`)},clearUserEmail:function(){l=null,y()&&localStorage.removeItem("userEmail"),e.debug&&console.log("[Analytics] User email cleared")},trackPromoImpression:function(t,e={}){this.trackEvent("promo_impression",{category:"promo",promo_id:t,...e,...m()})},trackPromoClick:function(t,e="click",n={}){this.trackEvent("promo_click",{category:"promo",promo_id:t,action:e,...n,...m()})},sendBatch:function(){return b()},trackUniqueVisitor:function(){v()},getConfig:function(){return{...e}},updateConfig:function(t){e={...e,...t},e.debug&&console.log("[Analytics] Config updated:",e)}};t.STKAnalytics=k;const A=function(){const t=document.getElementsByTagName("script");let e=null;for(let n of t)if(n.src&&n.src.includes("stk-analytics")&&n.getAttribute("data-api-key")){e=n;break}if(!e)return null;const n={},i=e.getAttribute("data-api-key");if(!i||""===i.trim())return console.error("STK Analytics: data-api-key attribute is required and cannot be empty"),null;n.apiKey=i;const a=e.getAttribute("data-api-url");return a&&(n.apiUrl=a),e.getAttribute("data-batch-interval")&&(n.batchIntervalMs=parseInt(e.getAttribute("data-batch-interval"))),e.getAttribute("data-debug")&&(n.debug="true"===e.getAttribute("data-debug").toLowerCase()),e.getAttribute("data-disable-page-views")&&(n.autoTrackPageViews=!1),e.getAttribute("data-disable-clicks")&&(n.autoTrackClicks=!1),e.getAttribute("data-disable-scroll")&&(n.autoTrackScroll=!1),Object.keys(n).length>0?n:null}();A?k.init(A):t.AnalyticsConfig&&k.init(t.AnalyticsConfig)}("undefined"!=typeof window?window:{});