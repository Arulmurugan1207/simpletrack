!function(e){"use strict";let t={apiUrl:"",serviceName:"unknown",batchIntervalMs:5e3,debug:!1,autoTrackPageViews:!0,autoTrackClicks:!0,autoTrackScroll:!0,autoTrackPerformance:!0},n=[],o=null,a=0,i=0,r=Date.now(),c="",s="",l=null,u=!1;function g(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function d(){if(void 0===e||!e.location)return{};const t=new URLSearchParams(e.location.search);return{utm_source:t.get("utm_source"),utm_medium:t.get("utm_medium"),utm_campaign:t.get("utm_campaign"),utm_term:t.get("utm_term"),utm_content:t.get("utm_content"),landing_page:e.location.pathname+e.location.search,landing_domain:e.location.hostname,referrer:document.referrer||null,referrer_domain:document.referrer?new URL(document.referrer).hostname:null}}function m(){try{const e="__analytics_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch{return!1}}function _(e,t=localStorage){try{return t.getItem(e)}catch{return null}}function f(e,n,o=localStorage){try{o.setItem(e,n)}catch(e){t.debug&&console.warn("[Analytics] Storage error:",e)}}function y(){!function(){try{const e="__analytics_test__";return sessionStorage.setItem(e,e),sessionStorage.removeItem(e),!0}catch{return!1}}()?c=g():(c=_("analytics_session_id",sessionStorage)||g(),f("analytics_session_id",c,sessionStorage)),m()?(s=_("analytics_user_id")||g(),f("analytics_user_id",s),l=_("userEmail")):s=g()}function p(o,r={}){const u=d(),g="undefined"==typeof navigator?{}:{userAgent:navigator.userAgent,language:navigator.language,platform:navigator.platform,screenResolution:`${screen.width}x${screen.height}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,cookieEnabled:navigator.cookieEnabled,online:navigator.onLine},y={event_category:r.category||"engagement",event_label:r.label||null,value:r.value||null,custom_parameters:r.custom||{},user_id:s,user_email:l,session_id:c,user_type:l?"authenticated":"anonymous",first_visit:_("analytics_first_visit")||(new Date).toISOString(),visit_count:parseInt(_("analytics_visit_count")||"0")+1,page:e.location?e.location.pathname:"",page_load_time:a,scroll_depth:i,time_on_page:0,attribution:u,...g,...r};m()&&(f("analytics_visit_count",y.visit_count.toString()),_("analytics_first_visit")||f("analytics_first_visit",y.first_visit));const p={event_name:o,user_id:s,user_email:l||void 0,data:y,service:t.serviceName};n.push(p),t.debug&&console.log(`[Analytics] Event "${o}":`,r)}async function h(){if(0===n.length||!t.apiUrl)return;if(t.debug)return t.debug&&console.log("[Analytics] Debug mode: Not sending batch to backend. Events in queue:",n.length),void(n=[]);const e=[...n];n=[],t.debug&&console.log("[Analytics] Sending batch:",e.length,"events");try{const n=await fetch(t.apiUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);t.debug&&console.log("[Analytics] Batch sent successfully")}catch(o){t.debug&&console.error("[Analytics] Batch send failed:",o),n.unshift(...e)}}const v={init:function(n={}){u?t.debug&&console.warn("[Analytics] Already initialized"):(t={...t,...n},t.apiUrl||(t.apiUrl="https://analytics-dot-node-server-apis.ue.r.appspot.com/analytics/log"),y(),void 0!==e&&"undefined"!=typeof document&&(e.addEventListener("load",()=>{a=performance.now(),p("page_load_complete",{category:"performance",custom:{load_time:a,dom_ready:performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]&&performance.getEntriesByType("navigation")[0].domContentLoadedEventEnd||0,fully_loaded:!0}})}),t.autoTrackScroll&&e.addEventListener("scroll",()=>{const t=e.pageYOffset||document.documentElement.scrollTop,n=document.body.offsetHeight||document.documentElement.offsetHeight,o=e.innerHeight,a=Math.round(t/(n-o)*100);i=Math.max(i,a)}),e.addEventListener("pagehide",()=>{p("page_exit",{time_on_page:Date.now()-r,scroll_depth:i,page:e.location?e.location.pathname:""}),h().catch(e=>{t.debug&&console.error("[Analytics] Page exit batch failed:",e)})}),document.addEventListener("visibilitychange",()=>{document.hidden?p("page_hidden",{time_on_page:Date.now()-r,scroll_depth:i,page:e.location?e.location.pathname:""}):r=Date.now()}),t.autoTrackClicks&&document.addEventListener("click",e=>{const t=e.target.closest("[data-click]");if(t){const n=t.getAttribute("data-click")||"click";p("click",{category:"interaction",label:t.textContent||t.innerText||"",element:t.tagName,href:t.href||null,click_type:n,custom:{x:e.clientX,y:e.clientY}})}}),t.autoTrackPageViews&&(p("page_view"),setTimeout(()=>{p("session_start",{category:"session",custom:{session_type:"new"}})},100))),o&&clearInterval(o),o=setInterval(()=>{h().catch(e=>{t.debug&&console.error("[Analytics] Batch timer error:",e)})},t.batchIntervalMs),u=!0,t.debug&&console.log("[Analytics] Initialized with config:",t))},trackEvent:function(e,n={}){u?p(e,n):t.debug&&console.warn("[Analytics] Not initialized. Call Analytics.init() first.")},trackInteraction:function(e,t,n={}){this.trackEvent("interaction",{category:"interaction",action:e,label:t,...n})},trackNavigation:function(e,t={}){this.trackEvent("navigation",{category:"navigation",page:e,...t})},trackError:function(e,t={}){this.trackEvent("error",{category:"error",error_message:e,...t})},trackPerformance:function(e,t,n={}){this.trackEvent("performance",{category:"performance",metric:e,value:t,...n})},setUserEmail:function(e){l=e,m()&&f("userEmail",e),t.debug&&console.log(`[Analytics] User email set: ${e}`)},clearUserEmail:function(){l=null,m()&&localStorage.removeItem("userEmail"),t.debug&&console.log("[Analytics] User email cleared")},trackPromoImpression:function(e,t={}){this.trackEvent("promo_impression",{category:"promo",promo_id:e,...t,...d()})},trackPromoClick:function(e,t="click",n={}){this.trackEvent("promo_click",{category:"promo",promo_id:e,action:t,...n,...d()})},sendBatch:function(){return h()},getConfig:function(){return{...t}},updateConfig:function(e){t={...t,...e},t.debug&&console.log("[Analytics] Config updated:",t)}};e.STKAnalytics=v,e.AnalyticsConfig&&v.init(e.AnalyticsConfig)}("undefined"!=typeof window?window:{});