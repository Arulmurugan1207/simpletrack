!function(w){'use strict';let c={apiUrl:'',serviceName:'unknown',batchIntervalMs:5e3,debug:!1,autoTrackPageViews:!0,autoTrackClicks:!0,autoTrackScroll:!0,autoTrackPerformance:!0},e=[],t=null,a=0,n=0,i=Date.now(),s='',o='',l=null,u=!1;function r(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(e){const t=16*Math.random()|0;return('x'===e?t:3&t|8).toString(16)})}function d(){if('undefined'==typeof w||!w.location)return{};const e=new URLSearchParams(w.location.search);return{utm_source:e.get('utm_source'),utm_medium:e.get('utm_medium'),utm_campaign:e.get('utm_campaign'),utm_term:e.get('utm_term'),utm_content:e.get('utm_content'),landing_page:w.location.pathname+w.location.search,landing_domain:w.location.hostname,referrer:document.referrer||null,referrer_domain:document.referrer?new URL(document.referrer).hostname:null}}function f(){if('undefined'==typeof navigator)return{};return{userAgent:navigator.userAgent,language:navigator.language,platform:navigator.platform,screenResolution:`${screen.width}x${screen.height}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,cookieEnabled:navigator.cookieEnabled,online:navigator.onLine}}function m(){try{const e='__analytics_test__';localStorage.setItem(e,e),localStorage.removeItem(e);return!0}catch{return!1}}function g(){try{const e='__analytics_test__';sessionStorage.setItem(e,e),sessionStorage.removeItem(e);return!0}catch{return!1}}function h(e,t=localStorage){try{return t.getItem(e)}catch{return null}}function p(e,t,a=localStorage){try{a.setItem(e,t)}catch(e){c.debug&&console.warn('[Analytics] Storage error:',e)}}function y(){g()?(s=h('analytics_session_id',sessionStorage)||r(),p('analytics_session_id',s,sessionStorage)):s=r(),m()?(o=h('analytics_user_id')||r(),p('analytics_user_id',o),l=h('userEmail')):o=r()}function v(t,r={}){const v=d(),b=f(),u={event_category:r.category||'engagement',event_label:r.label||null,value:r.value||null,custom_parameters:r.custom||{},user_id:o,user_email:l,session_id:s,user_type:l?'authenticated':'anonymous',first_visit:h('analytics_first_visit')||new Date().toISOString(),visit_count:parseInt(h('analytics_visit_count')||'0')+1,page:w.location?w.location.pathname:'',page_load_time:a,scroll_depth:n,time_on_page:0,attribution:v,...b,...r};m()&&(p('analytics_visit_count',u.visit_count.toString()),h('analytics_first_visit')||p('analytics_first_visit',u.first_visit));const d={event_name:t,user_id:o,user_email:l||void 0,data:u,service:c.serviceName};e.push(d),c.debug&&console.log(`[Analytics] Event "${t}":`,r)}async function b(){if(0===e.length||!c.apiUrl)return;if(c.debug)return c.debug&&console.log('[Analytics] Debug mode: Not sending batch to backend. Events in queue:',e.length),void(e=[]);const t=[...e];e=[],c.debug&&console.log('[Analytics] Sending batch:',t.length,'events');try{const e=await fetch(c.apiUrl,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(t)});if(e.ok)c.debug&&console.log('[Analytics] Batch sent successfully');else throw new Error(`HTTP ${e.status}: ${e.statusText}`)}catch(e){c.debug&&console.error('[Analytics] Batch send failed:',e),e.unshift(...t)}}function S(){t&&clearInterval(t),t=setInterval(()=>{b().catch(e=>{c.debug&&console.error('[Analytics] Batch timer error:',e)})},c.batchIntervalMs)}function E(){if('undefined'==typeof w||'undefined'==typeof document)return;w.addEventListener('load',()=>{a=performance.now(),v('page_load_complete',{category:'performance',custom:{load_time:a,dom_ready:performance.getEntriesByType&&performance.getEntriesByType('navigation')[0]&&performance.getEntriesByType('navigation')[0].domContentLoadedEventEnd||0,fully_loaded:!0}})}),c.autoTrackScroll&&w.addEventListener('scroll',()=>{const e=w.pageYOffset||document.documentElement.scrollTop,t=document.body.offsetHeight||document.documentElement.offsetHeight,a=w.innerHeight,i=Math.round(e/(t-a)*100);n=Math.max(n,i)}),w.addEventListener('pagehide',()=>{const e=Date.now()-i;v('page_exit',{time_on_page:e,scroll_depth:n,page:w.location?w.location.pathname:''}),b().catch(e=>{c.debug&&console.error('[Analytics] Page exit batch failed:',e)})}),document.addEventListener('visibilitychange',()=>{document.hidden?(v('page_hidden',{time_on_page:Date.now()-i,scroll_depth:n,page:w.location?w.location.pathname:''})):i=Date.now()}),c.autoTrackClicks&&document.addEventListener('click',e=>{const t=e.target.closest('[data-click]');if(t){const a=t.getAttribute('data-click')||'click';v('click',{category:'interaction',label:t.textContent||t.innerText||'',element:t.tagName,href:t.href||null,click_type:a,custom:{x:e.clientX,y:e.clientY}})}}),c.autoTrackPageViews&&(v('page_view'),setTimeout(()=>{v('session_start',{category:'session',custom:{session_type:'new'}})},100))}const A={init:function(e={}){if(u)return void(c.debug&&console.warn('[Analytics] Already initialized'));c={...c,...e},c.apiUrl||(c.apiUrl='https://analytics-dot-node-server-apis.ue.r.appspot.com/analytics/log'),y(),E(),S(),u=!0,c.debug&&console.log('[Analytics] Initialized with config:',c)},trackEvent:function(e,t={}){u?v(e,t):c.debug&&console.warn('[Analytics] Not initialized. Call Analytics.init() first.')},trackInteraction:function(e,t,a={}){this.trackEvent('interaction',{category:'interaction',action:e,label:t,...a})},trackNavigation:function(e,t={}){this.trackEvent('navigation',{category:'navigation',page:e,...t})},trackError:function(e,t={}){this.trackEvent('error',{category:'error',error_message:e,...t})},trackPerformance:function(e,t,a={}){this.trackEvent('performance',{category:'performance',metric:e,value:t,...a})},setUserEmail:function(e){l=e,m()&&p('userEmail',e),c.debug&&console.log(`[Analytics] User email set: ${e}`)},clearUserEmail:function(){l=null,m()&&localStorage.removeItem('userEmail'),c.debug&&console.log('[Analytics] User email cleared')},trackPromoImpression:function(e,t={}){this.trackEvent('promo_impression',{category:'promo',promo_id:e,...t,...d()})},trackPromoClick:function(e,t='click',a={}){this.trackEvent('promo_click',{category:'promo',promo_id:e,action:t,...a,...d()})},sendBatch:function(){return b()},getConfig:function(){return{...c}},updateConfig:function(e){c={...c,...e},c.debug&&console.log('[Analytics] Config updated:',c)}};w.STKAnalytics=A,w.AnalyticsConfig&&A.init(w.AnalyticsConfig)}('undefined'!=typeof window?window:{});