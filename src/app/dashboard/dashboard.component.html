<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse"
         [class.show]="sidebarOpen">
      <div class="position-sticky pt-3">
        <div class="d-flex d-md-none justify-content-between align-items-center px-3 mb-3">
          <h5 class="sidebar-title mb-0">Dashboard</h5>
          <button class="btn btn-sm btn-outline-secondary" (click)="toggleSidebar()">
            âœ•
          </button>
        </div>
        <h5 class="sidebar-title px-3 mb-3 d-none d-md-block">Dashboard</h5>
        <ul class="nav flex-column">
          <li class="nav-item">
            <button class="nav-link" [class.active]="activeTab === 'overview'" (click)="setActiveTab('overview')">
              <svg class="bi me-2" width="16" height="16"><use xlink:href="#home"/></svg>
              Overview
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-link" [class.active]="activeTab === 'reports'" (click)="setActiveTab('reports')">
              <svg class="bi me-2" width="16" height="16"><use xlink:href="#table"/></svg>
              Reports
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-link" [class.active]="activeTab === 'api-keys'" (click)="setActiveTab('api-keys')">
              <svg class="bi me-2" width="16" height="16"><use xlink:href="#people-circle"/></svg>
              API Keys
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-link" [class.active]="activeTab === 'billing'" (click)="setActiveTab('billing')">
              <svg class="bi me-2" width="16" height="16"><use xlink:href="#graph-up"/></svg>
              Billing
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-link" [class.active]="activeTab === 'settings'" (click)="setActiveTab('settings')">
              <svg class="bi me-2" width="16" height="16"><use xlink:href="#gear-wide-connected"/></svg>
              Settings
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-link" [class.active]="activeTab === 'help'" (click)="setActiveTab('help')">
              <svg class="bi me-2" width="16" height="16"><use xlink:href="#question-circle"/></svg>
              Help
            </button>
          </li>
        </ul>
      </div>
    </nav>

    <!-- Main content -->
    <main class="col-12 col-md-9 col-lg-10 ms-sm-auto px-3 px-md-4">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <!-- Mobile menu button -->
        <button class="btn btn-outline-secondary d-md-none me-2" (click)="toggleSidebar()">
          â˜°
        </button>

        <div class="welcome-section flex-grow-1">
          <h5 class="mb-0">Welcome {{ user?.email?.split('@')[0] || 'User' }}, today is {{ getTodayInfo() }}</h5>
        </div>

        <div class="btn-toolbar mb-2 mb-md-0 d-flex align-items-center gap-2">
          <div class="btn-group me-2 flex-grow-1 flex-md-grow-0">
            <input
              type="text"
              ngxDaterangepickerBootstrap
              [ranges]="dateRanges"
              [showCustomRangeLabel]="true"
              [alwaysShowCalendars]="true"
              [linkedCalendars]="true"
              [showClearButton]="true"
              [showCancel]="true"
              placeholder="Select date range"
              class="form-control"
              (rangeClicked)="onDateRangeSelected($event)"
              [(ngModel)]="selectedDateRange"
              name="daterange" />
          </div>
          @if (user) {
            <div ngbDropdown class="dropdown">
              <button class="btn btn-sm btn-outline-secondary profile-btn" type="button" ngbDropdownToggle>
                ðŸ‘¤
              </button>
              <div ngbDropdownMenu class="dropdown-menu">
                <div class="dropdown-header">{{ user.email }}</div>
                <div class="dropdown-divider"></div>
                <button ngbDropdownItem class="dropdown-item" (click)="setActiveTab('settings')">Account Settings</button>
                <button ngbDropdownItem class="dropdown-item" (click)="logout()">Logout</button>
              </div>
            </div>
          }
        </div>
      </div>

      <!-- Content Area -->
      <div class="content-area">
        @if (activeTab === 'overview') {
          <app-overview [dateRange$]="dateRange$"></app-overview>
        }
        @if (activeTab === 'reports') {
          <app-reports></app-reports>
        }
        @if (activeTab === 'api-keys') {
          <app-api-keys></app-api-keys>
        }
        @if (activeTab === 'billing') {
          <app-billing-usage></app-billing-usage>
        }
        @if (activeTab === 'settings') {
          <app-account-settings></app-account-settings>
        }
        @if (activeTab === 'help') {
          <app-help-support></app-help-support>
        }
      </div>
    </main>
  </div>
</div>
