<div class="dashboard-wrapper">
  <!-- Sidebar -->
  <nav class="sidebar" [class.sidebar-open]="sidebarOpen">
    <div class="sidebar-header">
      <div class="sidebar-brand">
        <i class="bi bi-bar-chart-line-fill me-2"></i>
        <span>SimpleTrack</span>
      </div>
      <button class="sidebar-close d-md-none" (click)="toggleSidebar()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>

    <div class="sidebar-nav">
      <div class="nav-section">
        <div class="nav-section-title">Navigation</div>
        <ul class="nav-list">
          <li class="nav-item">
            <button class="nav-link" (click)="goHome()">
              <i class="bi bi-arrow-left"></i>
              <span>Home</span>
            </button>
          </li>
        </ul>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Analytics</div>
        <ul class="nav-list">
          <li class="nav-item">
            <button class="nav-link" [class.active]="activeTab === 'overview'" (click)="setActiveTab('overview')">
              <i class="bi bi-house-door"></i>
              <span>Overview</span>
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-link" [class.active]="activeTab === 'api-keys'" (click)="setActiveTab('api-keys')">
              <i class="bi bi-key"></i>
              <span>API Keys</span>
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-link" [class.active]="activeTab === 'reports'" (click)="setActiveTab('reports')">
              <i class="bi bi-file-earmark-bar-graph"></i>
              <span>Reports</span>
            </button>
          </li>
        </ul>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Account</div>
        <ul class="nav-list">
          <li class="nav-item">
            <button class="nav-link" [class.active]="activeTab === 'plans'" (click)="setActiveTab('plans')">
              <i class="bi bi-credit-card"></i>
              <span>Plans</span>
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-link" [class.active]="activeTab === 'billing'" (click)="setActiveTab('billing')">
              <i class="bi bi-receipt"></i>
              <span>Billing</span>
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-link" [class.active]="activeTab === 'settings'" (click)="setActiveTab('settings')">
              <i class="bi bi-gear"></i>
              <span>Settings</span>
            </button>
          </li>
        </ul>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Support</div>
        <ul class="nav-list">
          <li class="nav-item">
            <button class="nav-link" [class.active]="activeTab === 'help'" (click)="setActiveTab('help')">
              <i class="bi bi-question-circle"></i>
              <span>Help</span>
            </button>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="main-content" [class.sidebar-open]="sidebarOpen">
    <!-- Top Header -->
    <header class="top-header">
      <div class="header-left">
        <button class="menu-toggle d-md-none" (click)="toggleSidebar()">
          <i class="bi bi-list"></i>
        </button>
        <div class="page-title">
          <h1 class="h4 mb-0">
            @switch (activeTab) {
              @case ('overview') { Overview }
              @case ('api-keys') { API Keys }
              @case ('plans') { Plans & Billing }
              @case ('reports') { Reports }
              @case ('billing') { Billing & Usage }
              @case ('settings') { Account Settings }
              @case ('help') { Help & Support }
              @default { Dashboard }
            }
          </h1>
        </div>
      </div>

      <div class="header-center d-none d-lg-flex">
        @if (activeTab === 'overview' || activeTab === 'reports') {
          <div class="date-range-picker">
            <input
              type="text"
              ngxDaterangepickerBootstrap
              [ranges]="dateRanges"
              [showCustomRangeLabel]="true"
              [alwaysShowCalendars]="true"
              [linkedCalendars]="true"
              [showClearButton]="true"
              [showCancel]="true"
              placeholder="Select date range"
              class="form-control form-control-sm"
              (rangeClicked)="onDateRangeSelected($event)"
              [(ngModel)]="selectedDateRange"
              name="daterange" />
          </div>
        }
      </div>

      <div class="header-right">
        <div class="user-info d-none d-md-block">
          <div class="user-greeting">
            <span class="text-muted">Welcome back,</span>
            <span class="fw-medium">{{ user?.email?.split('@')[0] || 'User' }}</span>
          </div>
          <div class="current-date text-muted small">
            {{ getTodayInfo() }}
          </div>
        </div>

        @if (user) {
          <div ngbDropdown class="user-menu">
            <button class="user-menu-btn" ngbDropdownToggle>
              <div class="user-avatar">
                <i class="bi bi-person-circle"></i>
              </div>
            </button>
            <div ngbDropdownMenu class="dropdown-menu-end">
              <div class="dropdown-header">
                <div class="user-email">{{ user.email }}</div>
              </div>
              <div class="dropdown-divider"></div>
              <button ngbDropdownItem class="dropdown-item" (click)="setActiveTab('settings')">
                <i class="bi bi-gear me-2"></i>Account Settings
              </button>
              <button ngbDropdownItem class="dropdown-item text-danger" (click)="logout()">
                <i class="bi bi-box-arrow-right me-2"></i>Logout
              </button>
            </div>
          </div>
        }
      </div>
    </header>

    <!-- Page Content -->
    <main class="page-content">
      <div class="content-wrapper">
        @if (activeTab === 'overview') {
          <app-overview [dateRange$]="dateRange$"></app-overview>
        }
        @if (activeTab === 'api-keys') {
          <app-api-keys></app-api-keys>
        }
        @if (activeTab === 'plans') {
          <app-plans></app-plans>
        }
        @if (activeTab === 'reports') {
          <app-reports></app-reports>
        }
        @if (activeTab === 'billing') {
          <app-billing-usage></app-billing-usage>
        }
        @if (activeTab === 'settings') {
          <app-account-settings></app-account-settings>
        }
        @if (activeTab === 'help') {
          <app-help-support></app-help-support>
        }
      </div>
    </main>
  </div>

  <!-- Mobile Overlay -->
  <div class="sidebar-overlay d-md-none" [class.active]="sidebarOpen" (click)="toggleSidebar()"></div>
</div>
