<!-- Main Dashboard Content -->
<main class="dashboard-main">
  <!-- Key Metrics Section -->
  <section class="metrics-section">
    <h2 class="section-title">ğŸ“Š Analytics Overview</h2>

    <!-- Top Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card primary">
        <div class="stat-icon">ğŸ‘¥</div>
        <div class="stat-content">
          <div class="stat-value">{{ formatNumber(metrics.liveVisitors) }}</div>
          <div class="stat-label">Live Visitors</div>
        </div>
        <div class="stat-trend positive">
          <span class="trend-icon">â†—</span>
          <span class="trend-value">+12%</span>
        </div>
      </div>

      <div class="stat-card secondary">
        <div class="stat-icon">ğŸ“„</div>
        <div class="stat-content">
          <div class="stat-value">{{ formatNumber(metrics.totalPageViews) }}</div>
          <div class="stat-label">Total Views</div>
        </div>
        <div class="stat-trend positive">
          <span class="trend-icon">â†—</span>
          <span class="trend-value">+8%</span>
        </div>
      </div>

      <div class="stat-card accent">
        <div class="stat-icon">ğŸ¯</div>
        <div class="stat-content">
          <div class="stat-value">{{ metrics.conversionRate }}%</div>
          <div class="stat-label">Conversion</div>
        </div>
        <div class="stat-trend neutral">
          <span class="trend-icon">â†’</span>
          <span class="trend-value">0%</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">â±ï¸</div>
        <div class="stat-content">
          <div class="stat-value">{{ formatDuration(metrics.avgSessionDuration) }}</div>
          <div class="stat-label">Avg Session</div>
        </div>
        <div class="stat-trend positive">
          <span class="trend-icon">â†—</span>
          <span class="trend-value">+5%</span>
        </div>
      </div>
    </div>

    <!-- Charts Row -->
    <div class="charts-row">
      <!-- Page Views Chart -->
      <div class="chart-card">
        <div class="chart-header">
          <h3>ğŸ“ˆ Page Views Trend</h3>
          <span class="chart-period">Last 7 days</span>
        </div>
        <div class="trend-chart-container">
          <canvas baseChart
                  [data]="barChartData"
                  [options]="barChartOptions"
                  [type]="barChartType">
          </canvas>
        </div>
      </div>

      <!-- Device Breakdown Pie Chart -->
      <div class="chart-card">
        <div class="chart-header">
          <h3>ğŸ“± Device Usage</h3>
          <span class="chart-period">Current session</span>
        </div>
        <div class="chart-container">
          <div class="doughnut-chart-container">
            <canvas baseChart
                    [data]="doughnutChartData"
                    [options]="doughnutChartOptions"
                    [type]="doughnutChartType">
            </canvas>
          </div>
          <div class="pie-legend">
            <div class="legend-item">
              <span class="legend-color desktop"></span>
              <span class="legend-text">Desktop: {{ deviceBreakdown.desktopPercentage }}%</span>
            </div>
            <div class="legend-item">
              <span class="legend-color mobile"></span>
              <span class="legend-text">Mobile: {{ deviceBreakdown.mobilePercentage }}%</span>
            </div>
            <div class="legend-item">
              <span class="legend-color tablet"></span>
              <span class="legend-text">Tablet: {{ deviceBreakdown.tabletPercentage }}%</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bottom Row -->
    <div class="bottom-row">
      <!-- Geographic Data -->
      <div class="data-card">
        <h3>ğŸŒ Top Countries</h3>
        <div class="countries-list">
          @for (geo of geoData; track geo.country) {
            <div class="country-item">
              <span class="country-name">{{ geo.country }}</span>
              <span class="country-stats">{{ geo.visitors }} ({{ geo.percentage }}%)</span>
            </div>
          }
        </div>
      </div>

  

      <!-- Conversion Funnel -->
      <div class="data-card">
        <h3>ğŸ¯ Conversion Funnel</h3>
        <div class="funnel-steps">
          @for (step of funnelSteps; track $index) {
            <div class="funnel-step">
              <span class="step-label">{{ funnelLabels[$index] }}</span>
              <span class="step-value">{{ step }}</span>
            </div>
          }
        </div>
      </div>
    </div>

    <!-- Full Width Top Pages -->
    <div id="top-pages-section" class="full-width-section">
      <div class="data-card full-width">
        <h3>ğŸ”¥ Top Pages</h3>
        <div class="pages-list">
          @for (page of paginatedPages; track page.path) {
            <div class="page-item">
              <span class="page-path">{{ page.path === '/' ? 'Home' : page.path }}</span>
              <span class="page-views">{{ page.views }}</span>
            </div>
          }
        </div>

        <!-- Pagination Controls -->
        @if (totalPages > 1) {
          <div class="pagination">
            <button
              class="pagination-btn"
              [disabled]="currentPage === 1"
              (click)="previousPage()">
              â€¹ Previous
            </button>

            <div class="pagination-numbers">
              @for (page of totalPagesArray; track page) {
                <button
                  class="pagination-number"
                  [class.active]="page === currentPage"
                  (click)="goToPage(page)">
                  {{ page }}
                </button>
              }
            </div>

            <button
              class="pagination-btn"
              [disabled]="currentPage === totalPages"
              (click)="nextPage()">
              Next â€º
            </button>
          </div>
        }
      </div>
    </div>

    <!-- Realtime Events Section -->
    <div class="realtime-section">
      <div class="data-card realtime-card">
        <h3>âš¡ Live Events</h3>
        <div class="realtime-events">
          @for (event of realtimeEvents; track event.timestamp) {
            <div class="event-item" [class]="event.event_name">
              <div class="event-icon">
                @if (event.event_name === 'page_view' || event.event_name === 'navigation') {
                  <span>ğŸ‘ï¸</span>
                }
                @if (event.event_name === 'click') {
                  <span>ğŸ–±ï¸</span>
                }
                @if (event.event_name === 'scroll') {
                  <span>ğŸ“œ</span>
                }
                @if (event.event_name === 'page_hidden') {
                  <span>ğŸ‘ï¸â€ğŸ—¨ï¸</span>
                }
                @if (event.event_name === 'form_submit') {
                  <span>ğŸ“</span>
                }
                @if (event.event_name === 'purchase') {
                  <span>ğŸ’°</span>
                }
                @if (event.data.event_category === 'engagement') {
                  <span>ğŸ¯</span>
                }
              </div>
              <div class="event-content">
                <div class="event-type">
                  {{ event.event_name.replace('_', ' ') | titlecase }}
                  @if (event.data.event_category) {
                    <span class="event-category">({{ event.data.event_category }})</span>
                  }
                </div>
                <div class="event-details">
                  <span class="page-info">{{ event.data.page }}</span>
                  <span class="user-info">
                    {{ event.data.user_type }} user â€¢ {{ event.data.country }}
                    @if (event.data.visit_count) {
                      â€¢ Visit #{{ event.data.visit_count }}
                    }
                  </span>
                  @if (event.data.time_on_page && event.data.time_on_page > 0) {
                    <span class="time-info">â€¢ {{ formatDuration(event.data.time_on_page / 1000) }} on page</span>
                  }
                </div>
              </div>
              <div class="event-time">{{ getTimeAgo(event.timestamp) }}</div>
            </div>
          }
        </div>
      </div>
    </div>
  </section>
</main>
